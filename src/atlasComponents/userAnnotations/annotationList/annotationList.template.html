<div aria-label="user annotations viewer" class="annotation-content w-100">

    <div aria-label="user annotations header" class="overflow-hidden mt-3 mr-2 ml-2">
        <div arial-label="user annotations footer" class="d-flex justify-content-between">
            <div>
                <button class="mr-1 ml-1" mat-icon-button
                        disabled
                        aria-label="Import user annotation"
                        matTooltip="Import">
                    <i class="fas fa-file-import"></i>
                </button>
                <button class="mr-1 ml-1" mat-icon-button
                        disabled
                        aria-label="Export user annotation"
                        matTooltip="Export">
                    <i class="fas fa-file-export"></i>
                </button>
            </div>
            <div class="d-flex flex-column">
                <small [ngClass]="[ans.annotationFilter !== 'all'? 'inactive-filter' : '']"
                       class="cursor-pointer" (click)="ans.changeAnnotationFilter('all')">
                    All landmarks
                </small>
                <small [ngClass]="[ans.annotationFilter !== 'current'? 'inactive-filter' : '']"
                       class="cursor-pointer" (click)="ans.changeAnnotationFilter('current')">
                    Current template
                </small>
            </div>
        </div>
    </div>
    <mat-divider class="mt-2 mb-2"></mat-divider>

    <mat-accordion aria-label="user annotations list"
                 class="h-100 d-flex flex-column overflow-auto">
<!--        <mat-expansion-panel hideToggle *ngFor="let annotation of ans.annotations | groupAnnotationPolygons; let i = index;">-->
        <mat-expansion-panel #expansion hideToggle *ngFor="let annotation of ans.displayAnnotations; let i = index; trackBy: identifyer">
            <mat-expansion-panel-header>

                <mat-panel-title>
                    <small class="cursor-pointer mr-3 ml-1 d-flex align-items-center"
                            aria-label="Hide annotation"
                            [matTooltip]="annotation.annotationVisible? 'Hide' : 'Show'"
                            (click)="$event.stopPropagation(); toggleAnnotationVisibility(annotation)">
                        <i class="fas far fa-check-circle" *ngIf="annotation.annotationVisible; else notVisible"></i>
                        <ng-template #notVisible><i class="far fa-circle"></i></ng-template>
                    </small>
                    <input class="font-italic outline-none color-inherit"
                           (click)="expansion.expanded? $event.stopPropagation() : null"
                           [(ngModel)]="annotation.name"
                           (keyup)="this.saveAnnotation(annotation)"/>
<!--                    <span class="mr-2">{{annotation.name}}</span>-->
                </mat-panel-title>

                <mat-panel-description class="w-100 d-flex align-items-center justify-content-end"
                                       [matTooltip]="annotation.type">
                    <small><i [ngClass]="annotation.type === 'line'? 'fas fa-slash'
                        : annotation.type === 'bounding box'? 'far fa-square'
                        : annotation.type === 'ellipsoid'? 'fas fa-bullseye'
                        : annotation.type === 'polygonParent' || annotation.type === 'polygon'? 'fas fa-draw-polygon'
                         : 'fas fa-circle'"></i></small>
                </mat-panel-description>



            </mat-expansion-panel-header>


            <div>
                <small class="mt-2 mb-2">{{annotation.templateName}}</small>

                <div *ngIf="annotation.type !== 'polygon'" class="w-100 d-flex align-items-center justify-content-between mt-2">
                    <input class="w-100 font-italic outline-none color-inherit"
                           [(ngModel)]="annotation.position1"
                           (keyup)="this.saveAnnotation(annotation)"/>
                    <small class="d-flex align-items-center">mm <i class="fas fa-map-marked-alt mr-2 ml-2 cursor-pointer" (click)="navigate(annotation.position1)"></i></small>
                </div>

                <div *ngIf="annotation.type !== 'polygon' && annotation.position2" class="w-100 d-flex align-items-center justify-content-between mb-2">
                    <input class="w-100 font-italic d-flex align-items-center outline-none color-inherit"
                           [(ngModel)]="annotation.position2"
                           (keyup)="this.saveAnnotation(annotation)"/>
                    <small class="d-flex align-items-center">mm <i class="fas fa-map-marked-alt mr-2 ml-2 cursor-pointer" (click)="navigate(annotation.position2)"></i></small>
                </div>

                <div *ngIf="annotation.type === 'polygon'">
                    <div *ngFor="let position of annotation.positions" class="w-100 d-flex align-items-center justify-content-between mb-2">
                        <input class="w-100 font-italic d-flex align-items-center outline-none color-inherit"
                               [value]="position?.position"
                               (keyup)="this.saveAnnotation(annotation)"/>
                        <small class="d-flex align-items-center">mm <i class="fas fa-map-marked-alt mr-2 ml-2 cursor-pointer" (click)="navigate(annotation?.position?.position)"></i></small>
                    </div>
                </div>


                <div class="w-100">
                    <textarea class="w-100 outline-none color-inherit"
                              placeholder="Add description"
                              cdkTextareaAutosize
                              #autosize="cdkTextareaAutosize"
                              cdkAutosizeMinRows="1"
                              cdkAutosizeMaxRows="5"
                              [(ngModel)]="annotation.description"
                              (keyup)="this.saveAnnotation(annotation)"></textarea>
                </div>



                <div class="d-flex align-items-center justify-content-end w-100">
                    <button class="mr-1 ml-1" mat-icon-button
                            disabled
                            aria-label="Export single annotation">
                        <i class="fas fa-file-export"></i>
                    </button>
                    <button class="mr-1 ml-1" mat-icon-button
                            aria-label="Delete annotation"
                            (click)="removeAnnotation(annotation)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>

                <edit-annotation [annotation]="annotation" *ngIf="editing === i" (finished)="editing = -1">
                </edit-annotation>
            </div>

        </mat-expansion-panel>

    </mat-accordion>

</div>
