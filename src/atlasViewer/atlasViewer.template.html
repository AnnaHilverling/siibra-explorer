<ng-container *ngIf="meetsRequirement; else doesNotMeetReqTemplate">

  <ng-container *ngTemplateOutlet="viewerBody">
  </ng-container>
</ng-container>

<!-- kg tos -->
<ng-template #kgToS>
  <h2 mat-dialog-title>Knowldge Graph ToS</h2>
  <mat-dialog-content class="w-50vw">
    <kgtos-component>
    </kgtos-component>
  </mat-dialog-content>

  <mat-dialog-actions class="justify-content-end">
    <button color="primary" mat-raised-button (click)="kgTosClickedOk()" cdkFocusInitial>
      Ok
    </button>
  </mat-dialog-actions>
</ng-template>

<!-- cookie -->
<ng-template #cookieAgreementComponent>
  <h2 mat-dialog-title>Cookie Disclaimer</h2>
  <mat-dialog-content class="w-50vw">
    <cookie-agreement>
    </cookie-agreement>
  </mat-dialog-content>

  <mat-dialog-actions class="justify-content-end">
    <button color="primary" mat-raised-button (click)="cookieClickedOk()" cdkFocusInitial>
      Ok
    </button>
  </mat-dialog-actions>
</ng-template>

<!-- atlas template -->
<ng-template #viewerBody>
  <div class="atlas-container" (drag-drop)="localFileService.handleFileDrop($event)">

    <ui-nehuba-container iav-mouse-hover #iavMouseHoverEl="iavMouseHover"
      [currentOnHoverObs$]="iavMouseHoverEl.currentOnHoverObs$"
      [currentOnHover]="iavMouseHoverEl.currentOnHoverObs$ | async"
      (contextmenu)="$event.stopPropagation(); $event.preventDefault();"
      (mousedown)="mouseDownNehuba($event)"
      (mouseup)="mouseUpNehuba($event)">
    </ui-nehuba-container>

    <div class="z-index-10 position-absolute pe-none w-100 h-100">

      <!-- dataset search side nav -->
      <mat-drawer-container *ngIf="newViewer$ | async" [hasBackdrop]="false"
        class="w-100 h-100 bg-none mat-drawer-content-overflow-visible">
        <mat-drawer mode="push"
          class="col-10 col-sm-10 col-md-4 col-lg-3 col-xl-2 p-2 bg-none box-shadow-none overflow-visible"
          [disableClose]="true" [autoFocus]="false" [opened]="true" #sideNavDrawer>
          <search-side-nav (dismiss)="sideNavDrawer.close()" (open)="sideNavDrawer.open()"
            class="h-100 d-block overflow-visible" #searchSideNav>
          </search-side-nav>

        </mat-drawer>

        <!-- tag for opening and closing side nav -->
        <div class="d-flex h-100 align-items-start bg-none pe-none">

          <button mat-flat-button matBadgePosition="above after" matBadgeColor="accent"
            [matBadge]="!sideNavDrawer.opened && (selectedRegions$ | async)?.length ? (selectedRegions$ | async)?.length : null"
            [matTooltip]="!sideNavDrawer.opened ? (selectedRegions$ | async)?.length ?  ('Explore ' + (selectedRegions$ | async)?.length + ' selected regions.') : 'Explore current view' : null"
            [ngClass]="{'translate-x-6-n': !sideNavDrawer.opened, 'translate-x-7-n': sideNavDrawer.opened}"
            class="pe-all mt-5" (click)="sideNavDrawer.toggle()">
            <i [ngClass]="{'fa-chevron-left': sideNavDrawer.opened, 'fa-chevron-right': !sideNavDrawer.opened}"
              class="fas translate-x-3"></i>

          </button>

          <mat-card *ngIf="!sideNavDrawer.opened" (click)="sideNavDrawer.open()" mat-ripple
            class="pe-all mt-4 muted translate-x-4-n">
            <mat-card-content>
              <viewer-state-mini>
              </viewer-state-mini>
            </mat-card-content>
            <mat-card-footer></mat-card-footer>
          </mat-card>

          <!-- TODO clean up menu icon -->
        </div>
      </mat-drawer-container>
    </div>

    <div class="d-flex flex-row justify-content-end z-index-10 position-absolute pe-none w-100 h-100">
      <signin-banner
              signinWrapper
              [parcellationIsSelected]="selectedParcellation? true : false">
      </signin-banner>
    </div>

    <layout-floating-container zIndex="13" #floatingOverlayContainer>
      <div floatingContainerDirective>

      </div>

      <div class="fixed-bottom pe-none d-flex justify-content-end m-4">
        <ng-container *ngTemplateOutlet="logoTmpl">
        </ng-container>
      </div>

      <div floatingMouseContextualContainerDirective>

        <div class="d-inline-block" iav-mouse-hover #iavMouseHoverConetxtualBlock="iavMouseHover" contextualBlock>

          <ng-container
            *ngFor="let labelText of iavMouseHoverConetxtualBlock.currentOnHoverObs$ | async | mouseOverTextPipe : selectedParcellation">

            <mat-list dense>

              <mat-list-item class="h-auto">

                <mat-icon [fontSet]="(labelText.label | mouseOverIconPipe).fontSet"
                  [fontIcon]="(labelText.label | mouseOverIconPipe).fontIcon" mat-list-icon>

                </mat-icon>

                <div matLine *ngFor="let text of labelText.text" [innerHTML]="text">
                </div>
              </mat-list-item>
            </mat-list>
          </ng-container>
        </div>
        <!-- TODO Potentially implementing plugin contextual info -->
      </div>

      <panel-component class="shadow p-0 m-0" fixedMouseContextualContainerDirective>

        <div body class="pe-all" *ngIf="(onhoverSegmentsForFixed$ | async) as onHoverSegments">
          <mat-card *ngIf="onHoverSegments.length > 0 && regionToolsMenuVisible" class="d-flex flex-column p-0">
            <div *ngFor="let onHoverRegion of onHoverSegments; let i = index"
                 class="border-dark rounded mt-2">
              <div class="text-nowrap text-ellipsis mt-2 ml-2 mr-2 overflow-hidden" [matTooltip]="onHoverRegion.name"
                   matTooltipShowDelay="1000">{{onHoverRegion.name}}</div>
<!-- ToDo implement it with Descriptions-->
<!--              <div>-->
<!--                <div class="row m-2 position-relative overflow-hidden"-->
<!--                     [ngClass]="[collapsedRegionId === i? 'regionDescriptionTextOpened overflow-y-auto' : 'regionDescriptionTextClass', (+regionDescriptionText.scrollHeight > +regionDescriptionText.clientHeight) && collapsedRegionId !== i? 'regionDescriptionTextBefore' : '']"-->
<!--                     #regionDescriptionText>-->
<!--                  Description Text Here-->
<!--                </div>-->
<!--                <div (click)="collapsedRegionId = i"-->
<!--                     *ngIf="+regionDescriptionText.scrollHeight > +regionDescriptionText.clientHeight && collapsedRegionId !== i"-->
<!--                     class="w-100 d-flex justify-content-center align-items-center mt-n2 cursorPointer"><i-->
<!--                        class="fas fa-angle-down m-1"></i> Read More-->
<!--                </div>-->
<!--              </div>-->
              <div class="d-flex align-items-center justify-content-between">
                <button mat-button
                        matTooltip="Select region"
                        matTooltipShowDelay="1000"
                        style="font-size: 12px"
                        class="p-0 w-100"
                        *ngIf="(selectedRegions$ | async) as selectedRegions"
                        (click)="toggleRegionWithId(onHoverRegion.ngId, onHoverRegion.labelIndex, regionIsSelected(selectedRegions, onHoverRegion.ngId, onHoverRegion.labelIndex)); regionToolsMenuVisible = false; collapsedRegionId = -1">
                  <span class="fa-stack fa-1x" >
                    <i class="fas fa-hand-pointer fa-stack-1x"></i>
                    <i class="fas fa-slash fa-stack-1x fa-inverse" *ngIf="regionIsSelected(selectedRegions, onHoverRegion.ngId, onHoverRegion.labelIndex)"></i>
                  </span>
                  <span [innerText]="regionIsSelected(selectedRegions, onHoverRegion.ngId, onHoverRegion.labelIndex)? 'Unselect' : 'Select'"></span>
                </button>
                <button mat-button
                        matTooltip="Navigate to region"
                        matTooltipShowDelay="1000"
                        style="font-size: 12px"
                        class="p-0 w-100"
                        (click)="navigateTo(onHoverRegion.position); regionToolsMenuVisible = false; collapsedRegionId = -1">
                  <i class="fas fa-crosshairs"></i> Navigate
                </button>

<!-- ToDo Change other buttons font size to 10 if this button is available and remove w-100 classes-->
<!--                <button mat-button-->
<!--                        matTooltip="Navigate to region"-->
<!--                        matTooltipShowDelay="1000"-->
<!--                        style="font-size: 10px"-->
<!--                        class="p-0 mr-1">-->
<!--                  <i class="fab fa-connectdevelop"></i> Connectivity-->
<!--                </button>-->
              </div>
              <mat-divider *ngIf="onHoverSegments.length > 1 && i !== onHoverSegments.length-1"
                           class="mb-n2"></mat-divider>
            </div>
          </mat-card>
        </div>

      </panel-component>

    </layout-floating-container>

    <!-- required for manufacturing plugin templates -->
    <div pluginFactoryDirective>
    </div>
  </div>
</ng-template>

<!-- does not meet req template -->
<ng-template #doesNotMeetReqTemplate>
  <div class="d-flex flex-column w-100 h-100" *ngIf="!meetsRequirement">
    <div class="jumbotron bg-light text-center mb-0">
      <div>
        <h1 class="mb-3">
          <i class="fas fa-exclamation-triangle"></i> Unsupported browser detected
        </h1>
        <p>
          We recommend using the latest version of <a target="_blank" href="https://www.google.com/chrome/">Google
            Chrome</a>
          or <a target="_blank" href="https://www.mozilla.org/firefox/">Mozilla Firefox)</a> for viewing the interactive
          viewer.
        </p>
        <div class="col-6 d-inline-block text-left">
          <readmore-component [collapsedHeight]="0">
            <markdown-dom [markdown]="constantsService.minReqExplaner">

            </markdown-dom>
          </readmore-component>
        </div>

      </div>
    </div>
    <ng-container *ngFor="let preview of unsupportedPreviews; let idx = index">
      <div [hidden]="idx !== unsupportedPreviewIdx" class="text-center mb-3" imageContainer
        [style.backgroundImage]="'url(' + preview.previewSrc + ')'">
        <div class="mt-2 card d-inline-block displayCard">
          <div class="card-body">
            {{ preview.text }}
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<!-- logo tmpl -->
<ng-template #logoTmpl>
  <logo-container></logo-container>
</ng-template>
