<div
  class="d-flex"  
  [ngClass]="{ 'flex-column w-100 align-items-stretch' : isMobile}" >

  <dropdown-component
    *ngIf="selectedTemplate || isMobile"
    (itemSelected)="changeTemplate($event)"
    [activeDisplay]="displayActiveTemplate"
    [selectedItem]="selectedTemplate$ | async"
    [inputArray]="loadedTemplates$ | async | filterNull"
    [ngClass]="isMobile ? flexItemIsMobileClass : flexItemIsDesktopClass"
    (listItemButtonClicked)="showInfoToast($event, 'template')">
  </dropdown-component>

  <ng-container *ngIf="selectedTemplate$ | async as selectedTemplate">
    <dropdown-component
      *ngIf="selectedParcellation$ | async as selectedParcellation"
      (itemSelected)="changeParcellation($event)"
      [checkSelected]="compareParcellation"
      [activeDisplay]="displayActiveParcellation"
      [selectedItem]="selectedParcellation"
      [inputArray]="selectedTemplate.parcellations"
      [ngClass]="isMobile ? flexItemIsMobileClass : flexItemIsDesktopClass"
      (listItemButtonClicked)="showInfoToast($event, 'parcellation')">>

    </dropdown-component>
    <region-hierarchy
      [selectedRegions]="selectedRegions$ | async | filterNull"
      (singleClickRegion)="handleRegionClick({ mode: 'single', region: $event })"
      (doubleClickRegion)="handleRegionClick({ mode: 'double', region: $event })"
      (clearAllRegions)="clearAllRegions()"
      [isMobile] = "isMobile"
      *ngIf="selectedParcellation$ | async as selectedParcellation"
      class="h-0"
      [selectedParcellation]="selectedParcellation"
      [ngClass]="isMobile ? flexItemIsMobileClass : flexItemIsDesktopClass">

    </region-hierarchy>
  </ng-container>

  <!-- help btn -->
  <div class="btnWrapper">
    <div
      *ngIf="!isMobile && selectedTemplate"
      (click)="showHelp()" 
      class="btn btn-outline-secondary btn-sm rounded-circle login-icon">
      <i class="fas fa-question-circle"></i>
    </div>
  </div>

  <!-- signin -->

  <div class="btnWrapper">

    <div 
      *ngIf="!isMobile && selectedTemplate"
      (click)="showSignin()"
      class="btn btn-outline-secondary btn-sm rounded-circle login-icon">
      <i
        [ngClass]="user ? 'fa-user' : 'fa-sign-in-alt'"
        class="fas"></i>
    </div>
  </div>

  <div *ngIf="isMobile" class="login-button-panel-mobile">
    <div
      (click)="showSignin()"
      class="login-button-mobile">
      <button mat-button [ngStyle]="{'color': darktheme? '#D7D7D7' : 'black'}">Log In</button>
    </div>

    <div (click)="showHelp()" class="login-button-mobile">
      <button mat-button [ngStyle]="{'color': darktheme? '#D7D7D7' : 'black'}">Help</button>
    </div>

  </div>
</div>

<ng-template #publicationTemplate>
  <div *ngIf="loadedTemplates$ | async as loadedTemplates">
    <div *ngIf="chosenTemplateIndex !== null; else parcellationToast">
      <reference-toast-component *ngIf="loadedTemplates[chosenTemplateIndex]['properties'] && (loadedTemplates[chosenTemplateIndex]['properties']['description'] || loadedTemplates[chosenTemplateIndex]['properties']['publications'])"
                               [templateName] = "loadedTemplates[chosenTemplateIndex]['name'] ? loadedTemplates[chosenTemplateIndex]['name'] : null"
                               [templateDescription] = "loadedTemplates[chosenTemplateIndex]['properties']['description']? loadedTemplates[chosenTemplateIndex]['properties']['description'] : null"
                               [templatePublications] = "loadedTemplates[chosenTemplateIndex]['properties']['publications']? loadedTemplates[chosenTemplateIndex]['properties']['publications']: null"
                               [templateExternalLink] ="loadedTemplates[chosenTemplateIndex]['properties']['externalLink']? loadedTemplates[chosenTemplateIndex]['properties']['externalLink']: null">
      </reference-toast-component>
    </div>
    <ng-template #parcellationToast>
      <div *ngIf="(selectedTemplate$ | async) as selectedTemplate">
        <div *ngIf="selectedTemplate.parcellations[chosenParcellationIndex]['properties'] && (selectedTemplate.parcellations[chosenParcellationIndex]['properties']['description'] || selectedTemplate.parcellations[chosenParcellationIndex]['properties']['publications'])">
        <reference-toast-component
              [parcellationName] = "selectedTemplate.parcellations[chosenParcellationIndex]['name']? selectedTemplate.parcellations[chosenParcellationIndex]['name'] : null"
              [parcellationDescription] = "selectedTemplate.parcellations[chosenParcellationIndex]['properties']['description']? selectedTemplate.parcellations[chosenParcellationIndex]['properties']['description'] : null"
              [parcellationPublications] = "selectedTemplate.parcellations[chosenParcellationIndex]['properties']['publications']? selectedTemplate.parcellations[chosenParcellationIndex]['properties']['publications']: null"
              [parcellationNifti] = "selectedTemplate.parcellations[chosenParcellationIndex]['properties']['nifti']? selectedTemplate.parcellations[chosenParcellationIndex]['properties']['nifti'] : null"
              [parcellationExternalLink] ="selectedTemplate.parcellations[chosenParcellationIndex]['properties']['externalLink']? selectedTemplate.parcellations[chosenParcellationIndex]['properties']['externalLink']: null"
              [kgId]="selectedTemplate.parcellations[chosenParcellationIndex].properties?.kgId">
              
        </reference-toast-component>
        </div>
      </div>
    </ng-template>
  </div>
</ng-template>