<div class="d-flex"
  [iav-key-listener]="keyListenerConfig"
  (iav-key-event)="openTmplWithDialog(helpComponent)">

  <!-- signin -->
  <div class="btnWrapper">
    <button
      [matTooltip]="userBtnTooltip$ | async"
      matTooltipPosition="below"
      mat-icon-button
      [matMenuTriggerFor]="dropdownMenu"
      color="primary">
      <ng-template [ngIf]="user$ | async" [ngIfElse]="notLoggedInTmpl" let-user="ngIf">
        {{ (user && user.name || 'Unnamed User').slice(0,1) }}
      </ng-template>
      
      <ng-template #notLoggedInTmpl>
        <i class="fas fa-user"></i>
      </ng-template>
    </button>
  </div>
</div>

<!-- drop down  menu -->
<mat-menu #dropdownMenu>
  <mat-card>
    <mat-card-content>
      <signin-modal>
      </signin-modal>
    </mat-card-content>
  </mat-card>

  <mat-divider></mat-divider>

  <button (click)="openTmplWithDialog(pluginTmpl)" mat-menu-item>
    <mat-icon fontSet="fas" fontIcon="fa-cube"></mat-icon>
    Plugins
  </button>

  <button mat-menu-item
    (click)="openTmplWithDialog(settingTemplate)">
    <mat-icon fontSet="fas" fontIcon="fa-cog"></mat-icon>
    Setting
  </button>

  <button mat-menu-item
    (click)="openTmplWithDialog(helpComponent)">
    <mat-icon fontSet="fas" fontIcon="fa-info"></mat-icon>
    About
  </button>
</mat-menu>

<ng-template #pluginTmpl>
  <h2 mat-dialog-title>Plugins</h2>
  <mat-dialog-content>
    <plugin-banner (click)="openTmplWithDialog(null)"></plugin-banner>
  </mat-dialog-content>
</ng-template>

<ng-template #helpComponent>
  <h2 mat-dialog-title>About Interactive Viewer</h2>
  <mat-dialog-content>
    <mat-tab-group>
      <mat-tab label="Help">
        <help-component>
        </help-component>
      </mat-tab>
      <mat-tab label="Privacy Policy">
        <!-- TODO make tab container scrollable -->
        <cookie-agreement>
        </cookie-agreement>
      </mat-tab>
      <mat-tab label="Terms of Use">
        <kgtos-component>
        </kgtos-component>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>

  <mat-dialog-actions class="justify-content-center">
    <button
      mat-flat-button
      [mat-dialog-close]
      cdkFocusInitial>
      close
    </button>
  </mat-dialog-actions>
</ng-template>

<ng-template #settingTemplate>	
  <h2 mat-dialog-title>Settings</h2>	
  <mat-dialog-content>	
    <!-- required to avoid showing an ugly vertical scroll bar -->	
    <!-- TODO investigate why, then remove the friller class -->	
    <config-component class="mb-4 d-block">	
    </config-component>	
  </mat-dialog-content>	
</ng-template> 