
<!-- title -->
<mat-card-subtitle>
  <span *ngIf="name; else nameLoading">
    {{ name }}
  </span>
  <ng-template #nameLoading>
    <div class="spinnerAnimationCircle"></div>
  </ng-template>
</mat-card-subtitle>

<mat-card-content mat-dialog-content>

  <!-- description -->
  <small>
    <markdown-dom
      *ngIf="description; else descriptionLoading"
      class="d-block"
      [markdown]="description">

    </markdown-dom>

    <ng-template #descriptionLoading>
      <div class="d-inline-block spinnerAnimationCircle"></div>
    </ng-template>
  </small>

  <!-- publications -->
  <small class="d-block mb-2"
    *ngFor="let publication of publications">
    <a *ngIf="publication.doi; else plainText"
      iav-stop="click mousedown"
      [href]="publication.doi | doiParserPipe"
      target="_blank">
      {{ publication.cite }}
    </a>
    <ng-template #plainText>
      {{ publication.cite }}
    </ng-template>
  </small>
</mat-card-content>


<!-- footer -->
<mat-card-actions>

  <!-- explore -->
  <a *ngFor="let kgRef of kgReference"
    class="m-2"
    [href]="kgRef | doiParserPipe"
    target="_blank">
    <button 
      mat-raised-button
      color="primary">
      Explore
      <i class="fas fa-external-link-alt"></i>
    </button>
  </a>

  <!-- pin data -->
  <ng-container *ngIf="downloadEnabled && kgId">

    <!-- Is currently fav'ed -->
    <ng-container *ngIf="favedDataentries$ | async | datasetIsFaved : dataset; else notCurrentlyFav">

      <button mat-button
        iav-stop="click mousedown"
        (click)="undoableRemoveFav()"
        color="primary">
        Unpin this dataset
        <i class="fas fa-thumbtack"></i>
      </button>
    </ng-container>

    <!-- Is NOT currently fav'ed -->
    <ng-template #notCurrentlyFav>
      
      <button mat-button
        iav-stop="click mousedown"
        (click)="undoableAddFav()"
        color="default">
        Pin this dataset
        <i class="fas fa-thumbtack"></i>
      </button>
    </ng-template>
  </ng-container>


  <!-- download -->
  <a *ngIf="files && files.length > 0"
    [href]="dlFromKgHref"
    target="_blank">
    <button
      [disabled]="downloadInProgress"
      [matTooltip]="tooltipText"
      class="m-2"
      mat-button
      color="basic">
      <span>
        Download as Zip
      </span>
      <i class="ml-1 fas" [ngClass]="!downloadInProgress? 'fa-download' :'fa-spinner fa-pulse'"></i>
    </button>
  </a>


  <!-- check if has preview -->
  <kg-dataset-list
    class="d-none"
    [backendUrl]="DS_PREVIEW_URL"
    *ngIf="kgId"
    (kgDsPrvUpdated)="handleKgDsPrvUpdate($event)"
    [kgId]="kgId">

  </kg-dataset-list>

  <button mat-button
    mat-dialog-close
    *ngIf="hasPreview"
    (click)="showPreviewList(previewFilesListTemplate)"
    color="basic">
    <span>
      Preview
    </span>
    <i class="ml-1 far fa-eye"></i>
  </button>

</mat-card-actions>

<mat-card-footer></mat-card-footer>

<ng-template #previewFilesListTemplate>
  <dataset-preview-list
    [kgId]="kgId"
    (previewingFile)="handlePreviewFile($event)">

  </dataset-preview-list>
</ng-template>
