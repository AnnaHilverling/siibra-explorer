
<!-- title -->
<mat-card-subtitle>
  {{ name }}
</mat-card-subtitle>

<mat-card-content mat-dialog-content>
  <mat-grid-list *ngIf="false" [cols]="kgReference.length + (preview ? 1 : 0) + (downloadEnabled ? 2 : 0)" rowHeight="4em">

    <!-- explore -->
    <mat-grid-tile *ngFor="let kgRef of kgReference">
      <a [href]="kgRef | doiParserPipe"
        matTooltip="Explore"
        iav-stop="click mousedown"
        mat-icon-button
        target="_blank">
        <i class="fas fa-external-link-alt"></i>
      </a>
    </mat-grid-tile>

    <!-- pin -->
    <mat-grid-tile *ngIf="downloadEnabled">

      <button
        iav-stop="click mousedown"
        (click)="toggleFav()"
        matTooltip="Pin"
        mat-icon-button
        [color]="(favedDataentries$ | async | datasetIsFaved : dataset) ? 'primary' : 'basic'">
        <i class="fas fa-thumbtack"></i>
      </button>
    </mat-grid-tile>

    <!-- preview -->
    <mat-grid-tile *ngIf="preview">
      <button
        iav-stop="click mousedown"
        (click)="showPreviewList(previewFilesListTemplate)"
        matTooltip="Preview"
        mat-icon-button>
        <i class="far fa-eye"></i>
      </button>
    </mat-grid-tile>

    <!-- download -->
    <ng-container *ngIf="!strictLocal">

      <mat-grid-tile *ngIf="downloadEnabled">
        <a [href]="dlFromKgHref"
          target="_blank"
          iav-stop="click mousedown">
          <button
            matTooltip="Download"
            [disabled]="downloadInProgress"
            mat-icon-button>
            <i class="ml-1 fas" [ngClass]="!downloadInProgress? 'fa-download' :'fa-spinner fa-pulse'"></i>
          </button>
        </a>
      </mat-grid-tile>
    </ng-container>
  </mat-grid-list>

  <!-- description -->
  <small>
    <markdown-dom class="d-block" [markdown]="description">

    </markdown-dom>
  </small>

  <!-- publications -->
  <ng-container *ngIf="!strictLocal">

    <small class="d-block mb-2"
      *ngFor="let publication of publications">
      <a *ngIf="publication.doi; else plainText"
        iav-stop="click mousedown"
        [href]="publication.doi | doiParserPipe"
        target="_blank">
        {{ publication.cite }}
      </a>
      <ng-template #plainText>
        {{ publication.cite }}
      </ng-template>
    </small>
  </ng-container>
</mat-card-content>


<!-- footer -->
<mat-card-actions>

  <!-- explore -->
  <ng-container *ngIf="!strictLocal">

    <a *ngFor="let kgRef of kgReference"
      class="m-2"
      [href]="kgRef | doiParserPipe"
      target="_blank">
      <button 
        mat-raised-button
        color="primary">
        Explore
        <i class="fas fa-external-link-alt"></i>
      </button>
    </a>
  </ng-container>

  <!-- pin data -->
  <button mat-button
    *ngIf="downloadEnabled"
    iav-stop="click mousedown"
    (click)="toggleFav()"
    color="primary"
    [color]="(favedDataentries$ | async | datasetIsFaved : dataset) ? 'primary' : 'basic'">
    {{ (favedDataentries$ | async | datasetIsFaved : dataset) ? 'Unpin' : 'Pin' }} this dataset
    <i class="fas fa-thumbtack"></i>
  </button>


  <!-- download -->
  <ng-container *ngIf="!strictLocal">

    <a *ngIf="files.length > 0"
      [href]="dlFromKgHref"
      target="_blank">
      <button
        [disabled]="downloadInProgress"
        [matTooltip]="tooltipText"
        class="m-2"
        mat-button
        color="basic">
        <span>
          Download as Zip
        </span>
        <i class="ml-1 fas" [ngClass]="!downloadInProgress? 'fa-download' :'fa-spinner fa-pulse'"></i>
      </button>
    </a>
  </ng-container>

  <button mat-button
    mat-dialog-close
    *ngIf="preview"
    (click)="showPreviewList(previewFilesListTemplate)"
    color="basic">
    <span>
      Preview
    </span>
    <i class="ml-1 far fa-eye"></i>
  </button>
</mat-card-actions>

<mat-card-footer></mat-card-footer>

<ng-template #previewFilesListTemplate>
  <preview-component
    (previewFile)="handlePreviewFile($event)"
    [datasetName]="name">
  </preview-component>
</ng-template>