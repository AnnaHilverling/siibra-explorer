
<!-- title -->
<mat-card-subtitle>
  {{ name }}
</mat-card-subtitle>

<mat-card-content mat-dialog-content>
  <mat-grid-list *ngIf="false" [cols]="kgReference.length + (preview ? 1 : 0) + (downloadEnabled ? 2 : 0)" rowHeight="4em">

    <!-- explore -->
    <mat-grid-tile *ngFor="let kgRef of kgReference">
      <a [href]="kgRef | doiParserPipe"
        matTooltip="Explore"
        iav-stop="click mousedown"
        mat-icon-button
        target="_blank">
        <i class="fas fa-external-link-alt"></i>
      </a>
    </mat-grid-tile>

    <!-- pin -->
    <mat-grid-tile *ngIf="downloadEnabled">

      <button
        iav-stop="click mousedown"
        (click)="toggleFav()"
        matTooltip="Pin"
        mat-icon-button
        [color]="(favedDataentries$ | async | datasetIsFaved : dataset) ? 'primary' : 'basic'">
        <i class="fas fa-thumbtack"></i>
      </button>
    </mat-grid-tile>

    <!-- preview -->
    <mat-grid-tile *ngIf="preview">
      <button
        iav-stop="click mousedown"
        (click)="showPreviewList(previewFilesListTemplate)"
        matTooltip="Preview"
        mat-icon-button>
        <i class="far fa-eye"></i>
      </button>
    </mat-grid-tile>

    <!-- download -->
    <mat-grid-tile *ngIf="downloadEnabled">
      <a [href]="dlFromKgHref"
        target="_blank"
        iav-stop="click mousedown">
        <button
          matTooltip="Download"
          [disabled]="downloadInProgress"
          mat-icon-button>
          <i class="ml-1 fas" [ngClass]="!downloadInProgress? 'fa-download' :'fa-spinner fa-pulse'"></i>
        </button>
      </a>
    </mat-grid-tile>
  </mat-grid-list>

  <!-- description -->
  <small>
    <markdown-dom class="d-block" [markdown]="description">

    </markdown-dom>
  </small>

  <!-- publications -->
  <small class="d-block mb-2"
    *ngFor="let publication of publications">
    <a *ngIf="publication.doi; else plainText"
      iav-stop="click mousedown"
      [href]="publication.doi | doiParserPipe"
      target="_blank">
      {{ publication.cite }}
    </a>
    <ng-template #plainText>
      {{ publication.cite }}
    </ng-template>
  </small>
</mat-card-content>


<!-- footer -->
<mat-card-actions>

  <!-- explore -->
  <a *ngFor="let kgRef of kgReference"
    class="m-2"
    [href]="kgRef | doiParserPipe"
    target="_blank">
    <button 
      mat-raised-button
      color="primary">
      Explore
      <i class="fas fa-external-link-alt"></i>
    </button>
  </a>

  <!-- pin data -->
  <button mat-button
    *ngIf="downloadEnabled"
    iav-stop="click mousedown"
    (click)="toggleFav()"
    color="primary"
    [color]="(favedDataentries$ | async | datasetIsFaved : dataset) ? 'primary' : 'basic'">
    {{ (favedDataentries$ | async | datasetIsFaved : dataset) ? 'Unpin' : 'Pin' }} this dataset
    <i class="fas fa-thumbtack"></i>
  </button>


  <!-- download -->
  <a *ngIf="files.length > 0"
    [href]="dlFromKgHref"
    target="_blank">
    <button
      [disabled]="downloadInProgress"
      [matTooltip]="tooltipText"
      class="m-2"
      mat-button
      color="basic">
      <span>
        Download as Zip
      </span>
      <i class="ml-1 fas" [ngClass]="!downloadInProgress? 'fa-download' :'fa-spinner fa-pulse'"></i>
    </button>
  </a>

  <button mat-button
    mat-dialog-close
    *ngIf="preview"
    (click)="showPreviewList(previewFilesListTemplate)"
    color="basic">
    <span>
      Preview
    </span>
    <i class="ml-1 far fa-eye"></i>
  </button>
</mat-card-actions>

<mat-card-footer></mat-card-footer>

<ng-template #previewFilesListTemplate>
  <kg-dataset-list
    (kgDsPrvUpdated)="handleKgDsPrvUpdated($event)"
    class="d-none"
    [kgId]="kgId">
  
  </kg-dataset-list>
  
  <div *ngIf="loadingDatasetPreviewList; else datasetList" class="spinnerAnimationCircle"></div>

  <ng-template #datasetList>

    <mat-nav-list>
      <h3 mat-subheader>Available Preview Files</h3>
      <mat-list-item
        *ngFor="let file of datasetPreviewList"
        (click)="handlePreviewFile(file)">
        <mat-icon
          [fontSet]="(file | previewFileIconPipe).fontSet"
          [fontIcon]="(file | previewFileIconPipe).fontIcon"
          matListIcon>
        </mat-icon>
        <h4 mat-line>{{ file.name }}</h4>
        <p mat-line>mimetype: {{ file.mimetype }}</p>
      </mat-list-item>
    
      <small *ngIf="datasetPreviewList.length === 0"
        class="text-muted">
        There are no preview files in this parcellation/template space.
      </small>
      
    </mat-nav-list>
  </ng-template>
  
</ng-template>
