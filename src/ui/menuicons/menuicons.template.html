<logo-container *ngIf="!isMobile">
</logo-container>

<!-- hide icons when templates has yet been selected -->
<ng-template [ngIf]="selectedTemplate$ | async">

  <!-- layer browser -->
  <div
    matTooltip="Layer"
    matTooltipPosition="right"
    (click)="clickLayer($event)"
    [class]="layerBrowserBtnClass$ | async"
    class="btn">
    <i class="fas fa-layer-group">
    </i>
  </div>

  <!-- tools -->
  <sleight-of-hand>

    <!-- shown icon prior to mouse over -->
    <div
      [matBadgePosition]="badgetPosition"  
      [matBadge]="(launchedPlugins$ | async)?.length > 0 ? (launchedPlugins$ | async)?.length : null"
      [class]="(skeletonBtnClass$ | async) + ' btn'"
      sleight-of-hand-front>
      <i class="fas fa-tools"></i>
    </div>

    <!-- shown after mouse over -->
    <div
      class="d-flex flex-row soh-row"
      sleight-of-hand-back>

      <!-- placeholder icon -->
      <div
        [matBadgePosition]="badgetPosition"  
        [matBadge]="(launchedPlugins$ | async)?.length > 0 ? (launchedPlugins$ | async)?.length : null"
        [class]="(skeletonBtnClass$ | async) + ' btn muted'">
        <i class="fas fa-tools"></i>
      </div>

      <!-- render all fetched tools -->
      <div class="d-flex flex-column soh-column">
        <div
          *ngFor="let manifest of pluginServices.fetchedPluginManifests"
          [matTooltip]="manifest.displayName || manifest.name"
          matTooltipPosition="right"
          (click)="clickPluginIcon(manifest)"
          [class]="(getPluginBtnClass$ | async | menuIconPluginBtnClsPipe : manifest.name) + ' btn w-1em bs-content-box ' + mobileRespBtnClass">
          {{ (manifest.displayName || manifest.name).slice(0, 1) }}
        </div>

        <!-- add new tool btn -->
        <div
          matTooltip="Add new plugin"
          [matTooltipShowDelay]="100"
          matTooltipPosition="right"
          [class]="(skeletonBtnClass$ | async)">
          <i class="fas fa-plus"></i>
        </div>
      </div>
    </div>
  </sleight-of-hand>

  <!-- search kg -->
  <sleight-of-hand>
    <!-- shown icon prior to mouse over -->
    <div
      sleight-of-hand-front
      [class]="(skeletonBtnClass$ | async) + ' btn'"
      [matBadgePosition]="badgetPosition"
      [matBadge]="dbService.instantiatedWidgetUnits.length > 0 ? dbService.instantiatedWidgetUnits.length : null">
      <i class="fas fa-search"></i>
    </div>

    <!-- shown after mouse over -->
    <div
      sleight-of-hand-back
      class="d-flex flex-row align-items-center soh-row">

      <!-- placeholder icon -->
      <div
        [ngClass]="(skeletonBtnClass$ | async) + ' btn muted'"
        [matBadgePosition]="badgetPosition"
        [matBadge]="dbService.instantiatedWidgetUnits.length > 0 ? dbService.instantiatedWidgetUnits.length : null">
        <i class="fas fa-search"></i>
      </div>

      <!-- only renders if there is at least one search result -->
      <div
        *ngIf="dbService.instantiatedWidgetUnits.length > 0; else noKgSearchTemplate"
        class="position-relative">

        <div class="position-absolute d-flex flex-column soh-column">

          <!-- render all searched kg -->
          <sleight-of-hand
            *ngFor="let wu of dbService.instantiatedWidgetUnits"
            (click)="searchIconClickHandler(wu)">

            <!-- shown prior to mouseover -->
            <div
              [class]="(getKgSearchBtnCls$ | async | menuIconKgSearchBtnClsPipe : wu) + ' position-relative sleight-of-hand btn w-1em bs-content-box ' + mobileRespBtnClass"
              sleight-of-hand-front>
              <i class="fas fa-search"></i>
            </div>

            <!-- shown on mouse over -->
            <!-- showing additional information. in this case, name of the kg search -->
            <div class="d-flex flex-row align-items-center" sleight-of-hand-back>
              <div [class]="(getKgSearchBtnCls$ | async | menuIconKgSearchBtnClsPipe : wu) + ' btn w-1em bs-content-box ' + mobileRespBtnClass">
                <i class="fas fa-search"></i>
              </div>
              
              <!-- on hover, show full name and action possible: rename, close -->
              <div [class]="((darktheme$ | async) ? 'text-light' : 'text-dark' ) + ' h-0 d-flex flex-row align-items-center'">

                <sleight-of-hand class="ml-1 h-0">
                  <!-- prior mouse over -->
                  <div class="h-0 d-flex align-items-center flex-row" sleight-of-hand-front>
                    <div [class]="((darktheme$ | async) ? 'bg-dark' : 'bg-light' ) + ' muted d-flex flex-row align-items-center'">
                  
                      <small class="cursor-default ml-2 text-nowrap">
                        {{ wu.title }}
                      </small>
  
                      <!-- dummy class to keep height -->
                      <div
                        matTooltip="Rename"
                        matTooltipPosition="below"
                        [class]="(skeletonBtnClass$ | async) + ' invisible w-0 pe-none'">
                        <i class="fas fa-edit"></i>
                      </div>
                    </div>
                  </div>

                  <!-- on mouse over -->
                  <div class="h-0 d-flex align-items-center flex-row" sleight-of-hand-back>
                    <div [class]="((darktheme$ | async) ? 'bg-dark' : 'bg-light' ) + ' d-flex flex-row align-items-center'">
                      
                      <small class="cursor-default ml-2 text-nowrap">
                        {{ wu.title }}
                      </small>
  
                      <!-- rename -->
                      <div
                        (click)="renameKgSearchWidget($event, wu)"
                        matTooltip="Rename (NYI)"
                        matTooltipPosition="below"
                        [class]="(skeletonBtnClass$ | async) + ' text-muted'">
                        <i class="fas fa-edit"></i>
                      </div>

                      <!-- star -->
                      <div
                        (click)="favKgSearch($event, wu)"
                        matTooltip="Favourite (NYI)"
                        matTooltipPosition="below"
                        [class]="(skeletonBtnClass$ | async) + ' text-muted'">
                        <i class="far fa-star"></i>
                      </div>
  
                      <!-- close -->
                      <div
                        (click)="closeWidget($event, wu)"
                        matTooltip="Close"
                        matTooltipPosition="below"
                        [class]="skeletonBtnClass$ | async">
                        <i class="fas fa-times"></i>
                      </div>
                    </div>
                  </div>
                </sleight-of-hand> 
              </div>
            </div>
          </sleight-of-hand>
        </div>

        <!-- invisible icon to keep height of the otherwise unstable flex block -->
        <div class="invisible pe-none">
          <i class="fas fa-search"></i>
        </div>
      </div>

      <!-- displayed when no search is visible -->
      <ng-template #noKgSearchTemplate>
        <small [class]="((darktheme$ | async) ? 'bg-dark text-light' : 'bg-light text-dark') + ' muted pl-2 pr-2 p-1 text-nowrap'">
          Right click any area to search
        </small>
      </ng-template>
    </div>

  </sleight-of-hand>

  <!-- selected regions -->
  <sleight-of-hand>

    <!-- shown prior to mouse over -->
    <div
      sleight-of-hand-front
      [class]="(skeletonBtnClass$ | async) + ' btn'"
      [matBadgePosition]="badgetPosition"
      matBadgeColor="warn"
      [matBadge]="(selectedRegions$ | async).length > 0 ? (selectedRegions$ | async).length : null">
      <i class="fas fa-brain"></i>
    </div>

    <!-- shown upon mouseover -->
    <div
      sleight-of-hand-back
      class="d-flex flex-row align-items-center soh-row">

      <!-- place holder icon -->
      <div
        [class]="(skeletonBtnClass$ | async) + ' btn muted'"
        [matBadgePosition]="badgetPosition"
        matBadgeColor="warn"
        [matBadge]="(selectedRegions$ | async).length > 0 ? (selectedRegions$ | async).length : null">
        <i class="fas fa-brain"></i>
      </div>

      <div
        *ngIf="(selectedRegions$ | async).length > 0; else noBrainRegionSelected"
        class="position-relative">

        <!-- rendering all the selected regions -->
        <div [class]="((darktheme$ | async) ? 'text-light bg-dark' : 'text-dark bg-light') + ' position-absolute'">
          <div class="m-1 position-relative">
            <button
              mat-raised-button
              (click)="deselectAllRegions($event)"
              class="virtual-scroll-row"
              color="warn">
              <i class="fas fa-trash"></i>
              Deselect all {{ (selectedRegions$ | async).length }} region{{ (selectedRegions$ | async).length > 1 ? 's' : '' }}
            </button>
          </div>
          <mat-divider></mat-divider>
          <div class="virtual-scroll-viewport-container">
            <cdk-virtual-scroll-viewport
              class="d-flex-flex-column soh-column"
              itemSize="26">
              <div
                *cdkVirtualFor="let region of (selectedRegions$ | async)"
                class="virtual-scroll-unit">
                <sleight-of-hand>
                  <!-- prior to mouseover -->
                  <div
                    [class]="((darktheme$ | async) ? 'text-light bg-dark' : 'text-dark bg-light') + ' d-flex flex-row align-items-center virtual-scroll-row'"
                    sleight-of-hand-front>
                    <div class="ml-2 cursor-default text-nowrap">
                      {{ region.name }}
                    </div>
      
                    <!-- place holder icon to support height  -->
                    <div [class]="(skeletonBtnClass$ | async) + ' invisible w-0 pe-none'">
                      <i class="fas fa-trash"></i>
                    </div>
                  </div>
      
                  <!-- on mouse over -->
                  <div
                    [class]="((darktheme$ | async) ? 'text-light bg-dark' : 'text-dark bg-light') + ' d-flex flex-row align-items-center virtual-scroll-row'"
                    sleight-of-hand-back>
                    <div class="text-truncate selected-region-container ml-2 cursor-default text-nowrap">
                      {{ region.name }}
                    </div>
                    <div
                      *ngIf="region.position"
                      (click)="gotoRegion($event, region)"
                      matTooltip="Goto"
                      matTooltipPosition="below"
                      [class]="(skeletonBtnClass$ | async) + ' selected-region-actionbtn'">
                      <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <div
                      #trashBtn="matTooltip"
                      (mousedown)="trashBtn.hide()"
                      (click)="deselectRegion($event, region)"
                      matTooltip="Deselect"
                      matTooltipPosition="below"
                      [class]="(skeletonBtnClass$ | async) + ' selected-region-actionbtn'">
                      <i class="fas fa-trash"></i>
                    </div>
                  </div>
                </sleight-of-hand>
              </div>
            </cdk-virtual-scroll-viewport>
          </div>
        </div>

        <!-- invisible icon to keep height of the otherwise unstable flex block -->
        <div class="invisible pe-none">
          <i class="fas fa-brain"></i>
        </div>
      </div>

      <ng-template #noBrainRegionSelected>
        <small [class]="((darktheme$ | async) ? 'bg-dark text-light' : 'bg-light text-dark') + ' muted pl-2 pr-2 p-1 text-nowrap'">
          Double click any brain region to select it.
        </small>
      </ng-template>
    </div>
  </sleight-of-hand>
</ng-template>