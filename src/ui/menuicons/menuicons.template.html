<logo-container *ngIf="!isMobile">
</logo-container>

<!-- hide icons when templates has yet been selected -->
<ng-template [ngIf]="selectedTemplate$ | async">

  <!-- layer browser -->
  <sleight-of-hand>
    <div sleight-of-hand-front>
      <div [ngClass]="(skeletonBtnClass$ | async) + ' btn'">
        <i class="fas fa-layer-group"></i>
      </div>
    </div>
    <div class="d-flex flex-row align-items-start soh-row pe-none"
      sleight-of-hand-back>

      <div [ngClass]="(skeletonBtnClass$ | async) + ' btn muted pe-all'">
        <i class="fas fa-layer-group"></i>
      </div>

      <div [class]="((darktheme$ | async) ? 'bg-dark' : 'bg-light') + ' card pe-all'">
        <layer-browser #layerBrowser [showPlaceholder]="false">
        </layer-browser>
      </div>
      <ng-container *ngIf="(layerBrowser.nonBaseNgLayers$ | async).length === 0" #noNonBaseNgLayerTemplate>
        <small [class]="((darktheme$ | async) ? 'bg-dark text-light' : 'bg-light text-dark') + ' muted pl-2 pr-2 p-1 text-nowrap'">
          No additional layers added
        </small>
      </ng-container>
    </div>
  </sleight-of-hand>
  
  <!-- tools -->
  <sleight-of-hand>

    <!-- shown icon prior to mouse over -->
    <div
      [matBadgePosition]="badgetPosition"  
      [matBadge]="(launchedPlugins$ | async)?.length > 0 ? (launchedPlugins$ | async)?.length : null"
      [class]="(skeletonBtnClass$ | async) + ' btn'"
      sleight-of-hand-front>
      <i class="fas fa-tools"></i>
    </div>

    <!-- shown after mouse over -->
    <div
      class="d-flex flex-row soh-row align-items-start"
      sleight-of-hand-back>

      <!-- placeholder icon -->
      <div
        [matBadgePosition]="badgetPosition"  
        [matBadge]="(launchedPlugins$ | async)?.length > 0 ? (launchedPlugins$ | async)?.length : null"
        [class]="(skeletonBtnClass$ | async) + ' btn muted'">
        <i class="fas fa-tools"></i>
      </div>

      <!-- render all fetched tools -->
      <div class="d-flex flex-column soh-column">
        <div
          *ngFor="let manifest of pluginServices.fetchedPluginManifests"
          [matTooltip]="manifest.displayName || manifest.name"
          matTooltipPosition="right"
          (click)="clickPluginIcon(manifest)"
          [class]="(getPluginBtnClass$ | async | menuIconPluginBtnClsPipe : manifest.name) + ' btn w-1em bs-content-box ' + mobileRespBtnClass">
          {{ (manifest.displayName || manifest.name).slice(0, 1) }}
        </div>

        <!-- add new tool btn -->
        <div
          matTooltip="Add new plugin"
          [matTooltipShowDelay]="100"
          matTooltipPosition="right"
          [class]="(skeletonBtnClass$ | async)">
          <i class="fas fa-plus"></i>
        </div>
      </div>
    </div>
  </sleight-of-hand>

  <!-- search kg -->
  <sleight-of-hand>
    <!-- shown icon prior to mouse over -->
    <div
      sleight-of-hand-front
      [class]="(skeletonBtnClass$ | async) + ' btn'"
      [matBadgePosition]="badgetPosition"
      [matBadge]="dbService.instantiatedWidgetUnits.length > 0 ? dbService.instantiatedWidgetUnits.length : null">
      <i class="fas fa-search"></i>
    </div>

    <!-- shown after mouse over -->
    <div
      sleight-of-hand-back
      class="d-flex flex-row align-items-center soh-row pe-none">

      <!-- placeholder icon -->
      <div
        [ngClass]="(skeletonBtnClass$ | async) + ' btn muted pe-all'"
        [matBadgePosition]="badgetPosition"
        [matBadge]="dbService.instantiatedWidgetUnits.length > 0 ? dbService.instantiatedWidgetUnits.length : null">
        <i class="fas fa-search"></i>
      </div>

      <!-- only renders if there is at least one search result -->
      <div
        *ngIf="dbService.instantiatedWidgetUnits.length > 0; else noKgSearchTemplate"
        class="position-relative pe-all">

        <div class="position-absolute d-flex flex-column soh-column">

          <!-- render all searched kg -->
          <sleight-of-hand
            *ngFor="let wu of dbService.instantiatedWidgetUnits"
            (click)="searchIconClickHandler(wu)">

            <!-- shown prior to mouseover -->
            <div
              [class]="(getKgSearchBtnCls$ | async | menuIconKgSearchBtnClsPipe : wu) + ' position-relative sleight-of-hand btn w-1em bs-content-box ' + mobileRespBtnClass"
              sleight-of-hand-front>
              <i class="fas fa-search"></i>
            </div>

            <!-- shown on mouse over -->
            <!-- showing additional information. in this case, name of the kg search -->
            <div class="d-flex flex-row align-items-center" sleight-of-hand-back>
              <div [class]="(getKgSearchBtnCls$ | async | menuIconKgSearchBtnClsPipe : wu) + ' btn w-1em bs-content-box ' + mobileRespBtnClass">
                <i class="fas fa-search"></i>
              </div>
              
              <!-- on hover, show full name and action possible: rename, close -->
              <div [class]="((darktheme$ | async) ? 'text-light' : 'text-dark' ) + ' h-0 d-flex flex-row align-items-center'">

                <sleight-of-hand class="ml-1 h-0">
                  <!-- prior mouse over -->
                  <div class="h-0 d-flex align-items-center flex-row" sleight-of-hand-front>
                    <div [class]="((darktheme$ | async) ? 'bg-dark' : 'bg-light' ) + ' muted d-flex flex-row align-items-center'">
                  
                      <small class="cursor-default ml-2 text-nowrap">
                        {{ wu.title }}
                      </small>
  
                      <!-- dummy class to keep height -->
                      <div
                        matTooltip="Rename"
                        matTooltipPosition="below"
                        [class]="(skeletonBtnClass$ | async) + ' invisible w-0 pe-none'">
                        <i class="fas fa-edit"></i>
                      </div>
                    </div>
                  </div>

                  <!-- on mouse over -->
                  <div class="h-0 d-flex align-items-center flex-row" sleight-of-hand-back>
                    <div [class]="((darktheme$ | async) ? 'bg-dark' : 'bg-light' ) + ' d-flex flex-row align-items-center'">
                      
                      <small class="cursor-default ml-2 text-nowrap">
                        {{ wu.title }}
                      </small>
  
                      <!-- rename -->
                      <div
                        (click)="renameKgSearchWidget($event, wu)"
                        matTooltip="Rename (NYI)"
                        matTooltipPosition="below"
                        [class]="(skeletonBtnClass$ | async) + ' text-muted'">
                        <i class="fas fa-edit"></i>
                      </div>

                      <!-- star -->
                      <div
                        (click)="favKgSearch($event, wu)"
                        matTooltip="Favourite (NYI)"
                        matTooltipPosition="below"
                        [class]="(skeletonBtnClass$ | async) + ' text-muted'">
                        <i class="far fa-star"></i>
                      </div>
  
                      <!-- close -->
                      <div
                        (click)="closeWidget($event, wu)"
                        matTooltip="Close"
                        matTooltipPosition="below"
                        [class]="skeletonBtnClass$ | async">
                        <i class="fas fa-times"></i>
                      </div>
                    </div>
                  </div>
                </sleight-of-hand> 
              </div>
            </div>
          </sleight-of-hand>
        </div>

        <!-- invisible icon to keep height of the otherwise unstable flex block -->
        <div class="invisible pe-none">
          <i class="fas fa-search"></i>
        </div>
      </div>

      <!-- displayed when no search is visible -->
      <ng-template #noKgSearchTemplate>
        <small [class]="((darktheme$ | async) ? 'bg-dark text-light' : 'bg-light text-dark') + ' muted pl-2 pr-2 p-1 text-nowrap'">
          Right click any area to search
        </small>
      </ng-template>
    </div>

  </sleight-of-hand>

  <!-- selected regions -->
  <sleight-of-hand
    [doNotClose]="viewerStateController.focused">

    <!-- shown prior to mouse over -->
    <div
      sleight-of-hand-front
      [class]="(skeletonBtnClass$ | async) + ' btn'"
      [matBadgePosition]="badgetPosition"
      matBadgeColor="warn"
      [matBadge]="(selectedRegions$ | async).length > 0 ? (selectedRegions$ | async).length : null">
      <i class="fas fa-brain"></i>
    </div>

    <!-- shown upon mouseover -->
    <div
      sleight-of-hand-back
      class="d-flex flex-row align-items-center soh-row">

      <!-- place holder icon -->
      <div
        [class]="(skeletonBtnClass$ | async) + ' btn muted'"
        [matBadgePosition]="badgetPosition"
        matBadgeColor="warn"
        [matBadge]="(selectedRegions$ | async).length > 0 ? (selectedRegions$ | async).length : null">
        <i class="fas fa-brain"></i>
      </div>

      <div class="position-relative">

        <div [class]="((darktheme$ | async) ? 'bg-dark' : 'bg-light') + ' position-absolute card'">
          <viewer-state-controller #viewerStateController></viewer-state-controller>
        </div>
        
        <!-- invisible icon to keep height of the otherwise unstable flex block -->
        <div class="invisible pe-none">
          <i class="fas fa-brain"></i>
        </div>
      </div>

      <ng-template #noBrainRegionSelected>
        <small [class]="((darktheme$ | async) ? 'bg-dark text-light' : 'bg-light text-dark') + ' muted pl-2 pr-2 p-1 text-nowrap'">
          Double click any brain region to select it.
        </small>
      </ng-template>
    </div>
  </sleight-of-hand>
</ng-template>