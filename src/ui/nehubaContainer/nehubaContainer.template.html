<ng-template #container>
</ng-template>

<ui-splashscreen (contextmenu)="$event.stopPropagation();" *ngIf="!viewerLoaded">
</ui-splashscreen>

<!-- spatial landmarks overlay -->
<!-- loading indicator -->

<current-layout class="position-absolute w-100 h-100 d-block pe-none">
  <div class="w-100 h-100 position-relative" cell-i>
    <ng-content *ngTemplateOutlet="overlayi"></ng-content>
  </div>
  <div class="w-100 h-100 position-relative" cell-ii>
    <ng-content *ngTemplateOutlet="overlayii"></ng-content>
  </div>
  <div class="w-100 h-100 position-relative" cell-iii>
    <ng-content *ngTemplateOutlet="overlayiii"></ng-content>
  </div>
  <div class="w-100 h-100 position-relative" cell-iv>
    <ng-content *ngTemplateOutlet="overlayiv"></ng-content>
  </div>
</current-layout>

<layout-floating-container *ngIf="viewerLoaded && !isMobile">
  
  <!-- tmp fab -->
  <div class="m-3 load-fav-dataentries-fab position-absolute pe-all">
    <button
      (click)="bottomSheet.open(savedDatasets)"
      [matBadge]="(favDataEntries$ | async)?.length > 0 ? (favDataEntries$ | async)?.length : null "
      matBadgeColor="accent"
      matBadgePosition="above before"
      matTooltip="Pinned datasets"
      matTooltipPosition="before"
      mat-fab
      color="primary">
      <i class="fas fa-thumbtack"></i>
    </button>
  </div>

  <!-- StatusCard container-->
  <ui-status-card
    [selectedTemplate]="selectedTemplate"
    [isMobile]="isMobile"
    [onHoverSegmentName]="onHoverSegmentName$ | async"
    [nehubaViewer]="nehubaViewer">
  </ui-status-card>
</layout-floating-container>

<div id="scratch-pad">

</div>

<!-- mobile nub, allowing for ooblique slicing in mobile -->
<mobile-overlay
  *ngIf="isMobile && viewerLoaded"
  [tunableProperties]="tunableMobileProperties"
  (deltaValue)="handleMobileOverlayEvent($event)">
  <div class="base" delta>
    <div mobileObliqueGuide class="p-2 mb-4 shadow">
      {{ selectedProp }}
    </div>
  </div>
  <div class="base" guide>
    <div
      mobileObliqueGuide
      class="p-2 mb-4 shadow">
      <div>
        <i class="fas fa-arrows-alt-v"></i> oblique mode
      </div>
      <div>
        <i class="fas fa-arrows-alt-h"></i> rotate slice
      </div>
    </div>
  </div>
  <div
    (contextmenu)="$event.stopPropagation(); $event.preventDefault();"
    [ngStyle]="panelMode$ | async | mobileControlNubStylePipe"
    mobileObliqueCtrl
    initiator>
    <button mat-mini-fab color="primary">
      <i class="fas fa-globe"></i>
    </button>
  </div>
</mobile-overlay>

<!-- overlay templates -->
<!-- inserted using ngTemplateOutlet -->
<ng-template #overlayi>
  <layout-floating-container pos00 landmarkContainer>
    <nehuba-2dlandmark-unit *ngFor="let spatialData of (selectedPtLandmarks$ | async)"
      (mouseenter)="handleMouseEnterLandmark(spatialData)" (mouseleave)="handleMouseLeaveLandmark(spatialData)"
      [highlight]="spatialData.highlight ? spatialData.highlight : false"
      [fasClass]="spatialData.type === 'userLandmark' ? 'fa-chevron-down' : 'fa-map-marker'"
      [positionX]="getPositionX(0,spatialData)" [positionY]="getPositionY(0,spatialData)"
      [positionZ]="getPositionZ(0,spatialData)">
    </nehuba-2dlandmark-unit>

    <div *ngIf="sliceViewLoading0$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle">

      </div>
    </div>
  </layout-floating-container>
</ng-template>

<ng-template #overlayii>
  <layout-floating-container pos01 landmarkContainer>
      <nehuba-2dlandmark-unit *ngFor="let spatialData of (selectedPtLandmarks$ | async)"
        (mouseenter)="handleMouseEnterLandmark(spatialData)" (mouseleave)="handleMouseLeaveLandmark(spatialData)"
        [highlight]="spatialData.highlight ? spatialData.highlight : false"
        [fasClass]="spatialData.type === 'userLandmark' ? 'fa-chevron-down' : 'fa-map-marker'"
        [positionX]="getPositionX(1,spatialData)" [positionY]="getPositionY(1,spatialData)"
        [positionZ]="getPositionZ(1,spatialData)">
      </nehuba-2dlandmark-unit>

      <div *ngIf="sliceViewLoading1$ | async" class="loadingIndicator">
        <div class="spinnerAnimationCircle">

        </div>
      </div>
    </layout-floating-container>
</ng-template>

<ng-template #overlayiii>
  <layout-floating-container pos10 landmarkContainer>
    <nehuba-2dlandmark-unit *ngFor="let spatialData of (selectedPtLandmarks$ | async)"
      (mouseenter)="handleMouseEnterLandmark(spatialData)" (mouseleave)="handleMouseLeaveLandmark(spatialData)"
      [highlight]="spatialData.highlight ? spatialData.highlight : false"
      [fasClass]="spatialData.type === 'userLandmark' ? 'fa-chevron-down' : 'fa-map-marker'"
      [positionX]="getPositionX(2,spatialData)" [positionY]="getPositionY(2,spatialData)"
      [positionZ]="getPositionZ(2,spatialData)">
    </nehuba-2dlandmark-unit>

    <div *ngIf="sliceViewLoading2$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle">

      </div>
    </div>
  </layout-floating-container>
</ng-template>

<ng-template #overlayiv>
  <layout-floating-container pos11 landmarkContainer>
    <div *ngIf="perspectiveViewLoading$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle"></div>
      <div perspectiveLoadingText>
        {{ perspectiveViewLoading$ | async }}
      </div>
    </div>
  </layout-floating-container>
</ng-template>

<ng-template #savedDatasets>
  <mat-list rol="list">
    <h3 mat-subheader>Pinned Datasets</h3>

    <!-- place holder when no fav data is available -->
    <mat-card *ngIf="(!(favDataEntries$ | async)) || (favDataEntries$ | async).length === 0">
      <mat-card-content class="muted">
        No pinned dataset ... yet.
      </mat-card-content>
    </mat-card>

    <!-- render all fav dataset as mat list -->
    <mat-list-item
      class="align-items-center"
      *ngFor="let ds of (favDataEntries$ | async)"
      role="listitem">
      <span class="flex-grow-1 flex-shrink-1">
        {{ ds.name }}
      </span>

      <!-- download -->
      <button
        #downloadBtn="matButton"
        (click)="downloadDs($event, ds, downloadBtn)"
        matTooltip="Download Dataset"
        matTooltipPosition="after"
        color="primary"
        class="flex-grow-0 flex-shrink-0"
        mat-icon-button>
        <i class="fas fa-download"></i>
      </button>

      <!-- remove from fav -->
      <button
        (click)="removeFav($event, ds)"
        matTooltip="Remove Pin"
        matTooltipPosition="after"
        color="warn"
        class="flex-grow-0 flex-shrink-0"
        mat-icon-button>
        <i class="fas fa-trash"></i>
      </button>
    </mat-list-item>
  </mat-list>
</ng-template>
