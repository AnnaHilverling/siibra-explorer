<div iav-nehuba-viewer-container
  (iavNehubaViewerContainerViewerLoading)="handleViewerLoadedEvent($event)">
</div>

<ui-splashscreen iav-stop="mousedown mouseup touchstart touchmove touchend" *ngIf="!viewerLoaded">
</ui-splashscreen>

<!-- spatial landmarks overlay -->
<!-- loading indicator -->

<current-layout *ngIf="viewerLoaded" class="position-absolute w-100 h-100 d-block pe-none">
  <div class="w-100 h-100 position-relative" cell-i>
    <ng-content *ngTemplateOutlet="overlayi"></ng-content>
  </div>
  <div class="w-100 h-100 position-relative" cell-ii>
    <ng-content *ngTemplateOutlet="overlayii"></ng-content>
  </div>
  <div class="w-100 h-100 position-relative" cell-iii>
    <ng-content *ngTemplateOutlet="overlayiii"></ng-content>
  </div>
  <div class="w-100 h-100 position-relative" cell-iv>
    <ng-content *ngTemplateOutlet="overlayiv"></ng-content>
  </div>
</current-layout>

<layout-floating-container *ngIf="viewerLoaded">

  <!-- StatusCard container-->
  <div class="status-card-container muted-7">
    <ui-status-card
      *ngIf="!(useMobileUI$ | async)"
      [selectedTemplateName]="selectedTemplate && selectedTemplate.name"
      [isMobile]="useMobileUI$ | async"
      [nehubaViewer]="nehubaViewer">
    </ui-status-card>
  </div>
</layout-floating-container>

<div id="scratch-pad">
</div>

<!-- mobile nub. may be required when more advanced control is required on mobile. for now, disabled -->
<mobile-overlay
  *ngIf="false && (useMobileUI$ | async) && viewerLoaded"
  [iav-mobile-overlay-guide-tmpl]="mobileOverlayGuide"
  [tunableProperties]="tunableMobileProperties"
  [iav-mobile-overlay-hide-ctrl-btn]="(panelMode$ | async) !== 'SINGLE_PANEL'"
  [iav-mobile-overlay-ctrl-btn-pos]="panelMode$ | async | mobileControlNubStylePipe">

</mobile-overlay>

<ng-template #mobileOverlayGuide>
  <div>
    <i class="fas fa-arrows-alt-v"></i>
    <span>
      Select item
    </span>
  </div>
  <div>
    <i class="fas fa-arrows-alt-h"></i>
    <span>
      Modify item value
    </span>
  </div>
</ng-template>

<!-- overlay templates -->
<!-- inserted using ngTemplateOutlet -->
<ng-template #overlayi>
  <layout-floating-container pos00 landmarkContainer>
    <nehuba-2dlandmark-unit *ngFor="let spatialData of (selectedPtLandmarks$ | async)"
      (mouseenter)="handleMouseEnterLandmark(spatialData)"
      (mouseleave)="handleMouseLeaveLandmark(spatialData)"
      [highlight]="spatialData.highlight ? spatialData.highlight : false"
      [fasClass]="spatialData.type === 'userLandmark' ? 'fa-chevron-down' : 'fa-map-marker'"
      [positionX]="getPositionX(0,spatialData)"
      [positionY]="getPositionY(0,spatialData)"
      [positionZ]="getPositionZ(0,spatialData)">
    </nehuba-2dlandmark-unit>

    <!-- maximise/minimise button -->
    <maximise-panel-button
      (click)="toggleMaximiseMinimise(0)"
      [ngClass]="{ onHover: (panelOrder$ | async | reorderPanelIndexPipe : ( hoveredPanelIndices$ | async  )) === 0 }"
      [touch-side-class]="0"
      class="pe-all">
    </maximise-panel-button>
    
    <div *ngIf="sliceViewLoading0$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle">

      </div>
    </div>
  </layout-floating-container>
</ng-template>

<ng-template #overlayii>
  <layout-floating-container pos01 landmarkContainer>
    <nehuba-2dlandmark-unit *ngFor="let spatialData of (selectedPtLandmarks$ | async)"
      (mouseenter)="handleMouseEnterLandmark(spatialData)"
      (mouseleave)="handleMouseLeaveLandmark(spatialData)"
      [highlight]="spatialData.highlight ? spatialData.highlight : false"
      [fasClass]="spatialData.type === 'userLandmark' ? 'fa-chevron-down' : 'fa-map-marker'"
      [positionX]="getPositionX(1,spatialData)"
      [positionY]="getPositionY(1,spatialData)"
      [positionZ]="getPositionZ(1,spatialData)">
    </nehuba-2dlandmark-unit>

    <!-- maximise/minimise button -->
    <maximise-panel-button
      (click)="toggleMaximiseMinimise(1)"
      [ngClass]="{ onHover: (panelOrder$ | async | reorderPanelIndexPipe : ( hoveredPanelIndices$ | async  )) === 1 }"
      [touch-side-class]="1"
      class="pe-all">
    </maximise-panel-button>

    <div *ngIf="sliceViewLoading1$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle">

      </div>
    </div>
  </layout-floating-container>
</ng-template>

<ng-template #overlayiii>
  <layout-floating-container pos10 landmarkContainer>
    <nehuba-2dlandmark-unit *ngFor="let spatialData of (selectedPtLandmarks$ | async)"
      (mouseenter)="handleMouseEnterLandmark(spatialData)"
      (mouseleave)="handleMouseLeaveLandmark(spatialData)"
      [highlight]="spatialData.highlight ? spatialData.highlight : false"
      [fasClass]="spatialData.type === 'userLandmark' ? 'fa-chevron-down' : 'fa-map-marker'"
      [positionX]="getPositionX(2,spatialData)"
      [positionY]="getPositionY(2,spatialData)"
      [positionZ]="getPositionZ(2,spatialData)">
    </nehuba-2dlandmark-unit>

    <!-- maximise/minimise button -->
    <maximise-panel-button
      (click)="toggleMaximiseMinimise(2)"
      [ngClass]="{ onHover: (panelOrder$ | async | reorderPanelIndexPipe : ( hoveredPanelIndices$ | async  )) === 2 }"
      [touch-side-class]="2"
      class="pe-all">
    </maximise-panel-button>

    <div *ngIf="sliceViewLoading2$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle">

      </div>
    </div>
  </layout-floating-container>
</ng-template>

<ng-template #overlayiv>
  <layout-floating-container pos11 landmarkContainer>

    <!-- maximise/minimise button -->
    <maximise-panel-button
      (click)="toggleMaximiseMinimise(3)"
      [ngClass]="{ onHover: (panelOrder$ | async | reorderPanelIndexPipe : ( hoveredPanelIndices$ | async  )) === 3 }"
      [touch-side-class]="3"
      class="pe-all">
    </maximise-panel-button>
    
    <div *ngIf="perspectiveViewLoading$ | async" class="loadingIndicator">
      <div class="spinnerAnimationCircle"></div>

      <div perspectiveLoadingText>
        {{ perspectiveViewLoading$ | async }}
      </div>
    </div>
  </layout-floating-container>
</ng-template>
