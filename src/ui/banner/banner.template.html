<dropdown-component
  (itemSelected)="selectTemplate($event)"
  [activeDisplay]="displayActiveTemplate"
  [selectedItem]="selectedTemplate"
  [inputArray]="loadedTemplates$ | async | filterNull">

</dropdown-component>

<i 
  *ngIf="citationExists(selectedTemplate) && !isMobile" 
  [toastLength]="toastDuration"
  [showToast]="citation"
  class="fas fa-info-sign"
  #templateCitationAnchor>

  <ng-template #citation>
    <h4>
      Citations for {{ selectedTemplate ? selectedTemplate.name : '' }} 
    </h4>
    <citations-component
      [properties]="selectedTemplate.properties">
    </citations-component>
  </ng-template>

</i>

<dropdown-component
  *ngIf="selectedTemplate"
  (itemSelected)="selectParcellation($event)"
  [activeDisplay]="displayActiveParcellation"
  [selectedItem]="selectedParcellation"
  [inputArray]="selectedTemplate.parcellations">
</dropdown-component>

<i 
  *ngIf="citationExists(selectedParcellation) && !isMobile" 
  [toastLength]="toastDuration"
  [showToast]="citation"
  class="fas fa-info-sign"
  #parcellationCitationAnchor>
  <ng-template #citation>
    <h4>
      Citations for {{ selectedParcellation ? selectedParcellation.name : '' }} 
    </h4>
    <citations-component
      [properties]="selectedParcellation.properties">
    </citations-component>
  </ng-template>
</i>

<div 
  *ngIf="selectedTemplate"
  #searchRegionPopover
  searchRegionPopover>

  <input 
    (keydown.esc)="showRegionTree=false; $event.target.blur(); searchTerm=''"
    (focus)="showRegionTree=true"
    [value]="searchTerm"
    (input)="changeSearchTerm($event)"
    class="form-control" 
    type="text" 
    placeholder="Regions"/>
    
  <div 
    [@showState]
    *ngIf="showRegionTree" 
    hideScrollbarContainer>

    <div treeContainer #treeContainer>
      <div treeHeader>
        <span>{{ selectedRegions.length }} {{ selectedRegions.length > 1 ? 'regions' : 'region' }} selected</span> 
        <span (click)="clearRegions($event)" *ngIf="selectedRegions.length > 0" class="btn btn-link">clear all</span>
      </div>
      
      <flat-tree-component 
        [flatTreeViewPort]="treeContainer"
        (treeNodeClick)="handleClickRegion($event)"
        [inputItem]="aggregatedRegionTree"
        [renderNode]="displayTreeNode.bind(this)"
        [searchFilter]="filterTreeBySearch.bind(this)">
        
      </flat-tree-component>
    </div>
  </div>
</div>

<!-- help btn -->
<div *ngIf="isMobile" class="help-container">
  <i (click)="showHelp()" class="fas fa-question-circle"></i>
</div>
<i *ngIf="!isMobile" (click)="showHelp()" class="fas fa-question-circle"></i>

<!-- config btn -->
<div *ngIf="isMobile" class="help-container">
  <i (click)="showConfig()" class="fas fa-cog"></i>
</div>
<i *ngIf="!isMobile" (click)="showConfig()" class="fas fa-cog"></i>

<!-- login btn -->
<div *ngIf="isMobile" class="help-container">
  <i
    placement="auto"
    triggers="click"
    [outsideClick]="true"
    [popover]="loginPopover"
    [popoverTitle]="user ? 'Hi, ' + user.name : 'Login'"
    [ngClass]="user ? 'fa-user' : 'fa-sign-in-alt'"
    class="fas"
    containerClass="popoverContainer"></i>
</div>
<i
  *ngIf="!isMobile"
  placement="auto"
  triggers="click"
  [outsideClick]="true"
  [popover]="loginPopover"
  [popoverTitle]="user ? 'Hi, ' + user.name : 'Login with'"
  [ngClass]="user ? 'fa-user' : 'fa-sign-in-alt'"
  class="fas"
  containerClass="popoverContainer"></i>

<ng-template #loginPopover>
  <a
    (click)="loginBtnOnclick()"
    class="btn btn-sm btn-default"
    [href]="logoutHref"
    *ngIf="user">
    <i class="fas fa-log-out"></i>
    Logout
  </a>
  <div
    *ngIf="!user"
    class="btn-group-vertical">
    <a
      (click)="loginBtnOnclick()"
      class="btn btn-sm btn-default"
      *ngFor="let m of loginMethods"
      [href]="m.href">
      {{ m.name }}
    </a>
  </div>
</ng-template>